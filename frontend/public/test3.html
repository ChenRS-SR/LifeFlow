<!DOCTYPE html>
<html>
<body>
<h1>排查测试</h1>
<button onclick="t1()">A: 单引号JSON</button>
<button onclick="t2()">B: 双引号JSON</button>
<button onclick="t3()">C: 用JSON.stringify</button>
<pre id="r"></pre>

<script>
const url = 'http://127.0.0.1:8000/api/auth/register';
const headers = {'Content-Type': 'application/json'};

function log(s) { document.getElementById('r').textContent += '\n' + s; }

function t1() {
    log('\nA: 单引号...');
    fetch(url, {method: 'POST', headers: headers, body: '{"u":"a","p":"b"}'})
    .then(r => r.text().then(t => log('OK:' + r.status)))
    .catch(e => log('ERR:' + e.message));
}

function t2() {
    log('\nB: 双引号变量...');
    const body = '{"username":"test","password":"123"}';
    log('body=' + body);
    fetch(url, {method: 'POST', headers: headers, body: body})
    .then(r => r.text().then(t => log('OK:' + r.status)))
    .catch(e => log('ERR:' + e.message));
}

function t3() {
    log('\nC: JSON.stringify...');
    const obj = {username: 'u' + Date.now(), password: '123'};
    const body = JSON.stringify(obj);
    log('body=' + body);
    fetch(url, {method: 'POST', headers: headers, body: body})
    .then(r => r.text().then(t => log('OK:' + r.status)))
    .catch(e => log('ERR:' + e.message));
}
</script>
</body>
</html>
